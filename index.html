<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAg5z1F4Dx6z9x0VHrBc45gnzgBm0Sa65s",
    authDomain: "tc-1-81110.firebaseapp.com",
    projectId: "tc-1-81110",
    storageBucket: "tc-1-81110.appspot.com",
    messagingSenderId: "1020958300613",
    appId: "1:1020958300613:web:0f95e201916b1c5ea153ac"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const testBtn = document.getElementById('test-firebase');
  const originalText = testBtn.innerHTML;

  testBtn.addEventListener('click', async () => {
    testBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Probando...';
    try {
      await setDoc(doc(db, "pruebas", "conexion"), {
        test: "ok",
        fecha: serverTimestamp()
      });

      const docSnap = await getDoc(doc(db, "pruebas", "conexion"));

      if (docSnap.exists()) {
        testBtn.innerHTML = '<i class="fas fa-check-circle"></i> Éxito';
        testBtn.style.backgroundColor = '#4CAF50';
        alert("✅ Conexión con Firebase funciona!");
      }
    } catch (error) {
      testBtn.innerHTML = '<i class="fas fa-times-circle"></i> Error';
      testBtn.style.backgroundColor = '#F44336';
      alert("❌ Error: " + error.message);
      console.error(error);
    } finally {
      setTimeout(() => {
        testBtn.innerHTML = originalText;
        testBtn.style.backgroundColor = '#FF6F00';
      }, 3000);
    }
  });
</script>
