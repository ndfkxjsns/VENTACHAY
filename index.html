<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proceso de Orden de Compra y Fabricación</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .container {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #4cae4c;
        }
        #lista_productos {
            list-style: none;
            padding: 0;
            border: 1px solid #eee;
            margin-top: 5px;
            max-height: 150px;
            overflow-y: auto;
            display: none;
            background-color: white;
            z-index: 10;
            position: absolute;
            width: calc(100% - 32px); /* Adjust width for padding and border */
        }
        #lista_productos li {
            padding: 8px;
            cursor: pointer;
        }
        #lista_productos li:hover {
            background-color: #f9f9f9;
        }
        #detalles_orden table {
            width: 100%;
            border-collapse: collapse;
        }
        #detalles_orden th, #detalles_orden td {
            border-bottom: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        #detalles_orden th:last-child, #detalles_orden td:last-child {
            text-align: right;
        }
        #detalles_orden th:nth-child(2), #detalles_orden td:nth-child(2) {
            text-align: right;
        }
        #detalles_orden th:nth-child(3), #detalles_orden td:nth-child(3) {
            text-align: right;
        }
        #total_orden {
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Nueva Orden de Compra</h2>
        <div>
            <label for="buscar_producto">Buscar Producto:</label>
            <input type="text" id="buscar_producto" placeholder="Ingrese el nombre del producto">
            <ul id="lista_productos">
                <li data-nombre="LUNETAS" data-precio-m="10.00" data-precio-f="10.50" data-precio-p="11.00">LUNETAS</li>
                <li data-nombre="DIENTES TIBURONES" data-precio-m="12.00" data-precio-f="12.50" data-precio-p="13.00">DIENTES TIBURONES</li>
                <li data-nombre="HUEVITO PINTO" data-precio-m="8.00" data-precio-f="8.50" data-precio-p="9.00">HUEVITO PINTO</li>
                <li data-nombre="GUSANITO NEON" data-precio-m="9.50" data-precio-f="10.00" data-precio-p="10.50">GUSANITO NEON</li>
                <li data-nombre="OSITO ENCHILADO" data-precio-m="11.50" data-precio-f="12.00" data-precio-p="12.50">OSITO ENCHILADO</li>
                <li data-nombre="GOTITAS" data-precio-m="7.00" data-precio-f="7.50" data-precio-p="8.00">GOTITAS</li>
                <li data-nombre="PINGÜINO" data-precio-m="13.00" data-precio-f="13.50" data-precio-p="14.00">PINGÜINO</li>
                <li data-nombre="ALMENDRA CONFITADA" data-precio-m="15.00" data-precio-f="15.50" data-precio-p="16.00">ALMENDRA CONFITADA</li>
                <li data-nombre="OSITOS" data-precio-m="9.00" data-precio-f="9.50" data-precio-p="10.00">OSITOS</li>
                <li data-nombre="MANGUITO ENCHILADO" data-precio-m="10.50" data-precio-f="11.00" data-precio-p="11.50">MANGUITO ENCHILADO</li>
                <li data-nombre="GUSANITOS" data-precio-m="8.50" data-precio-f="9.00" data-precio-p="9.50">GUSANITOS</li>
            </ul>
        </div>

        <div>
            <label for="proveedor">Proveedor:</label>
            <select id="proveedor">
                <option value="">Seleccionar Proveedor</option>
                <option value="M">PROVEDOR M</option>
                <option value="F">PROVEDOR F</option>
                <option value="P">PROVEDOR P</option>
            </select>
        </div>

        <div>
            <label for="precio_producto">Precio:</label>
            <input type="text" id="precio_producto" value="" readonly>
        </div>

        <div>
            <label for="cantidad_orden">Cantidadado:</label>
            <input type="number" id="cantidad_orden" value="1" min="1">
        </div>

        <button id="agregar_producto">Agregar a la Orden</button>

        <div id="detalles_orden" style="margin-top: 20px; border: 1px solid #eee; padding: 10px;">
            <h3>Detalles de la Orden</h3>
            <table id="tabla_orden">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio Unitario</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody id="cuerpo_tabla_orden">
                    </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: bold;">Total:</td>
                        <td id="total_orden" style="text-align: right; font-weight: bold;">$0.00</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <button id="confirmar_orden" style="margin-top: 10px;">Confirmar Orden de Compra</button>
    </div>

  

    <script>
        const buscarProductoInput = document.getElementById('buscar_producto');
        const listaProductos = document.getElementById('lista_productos');
        const proveedorSelect = document.getElementById('proveedor');
        const precioProductoInput = document.getElementById('precio_producto');
        const cantidadOrdenInput = document.getElementById('cantidad_orden');
        const agregarProductoButton = document.getElementById('agregar_producto');
        const cuerpoTablaOrden = document.getElementById('cuerpo_tabla_orden');
        const totalOrdenElement = document.getElementById('total_orden');
        const confirmarOrdenButton = document.getElementById('confirmar_orden');

        let productos = [
            { nombre: 'LUNETAS', precio_m: 10.00, precio_f: 10.50, precio_p: 11.00 },
            { nombre: 'DIENTES TIBURONES', precio_m: 12.00, precio_f: 12.50, precio_p: 13.00 },
            { nombre: 'HUEVITO PINTO', precio_m: 8.00, precio_f: 8.50, precio_p: 9.00 },
            { nombre: 'GUSANITO NEON', precio_m: 9.50, precio_f: 10.00, precio_p: 10.50 },
            { nombre: 'OSITO ENCHILADO', precio_m: 11.50, precio_f: 12.00, precio_p: 12.50 },
            { nombre: 'GOTITAS', precio_m: 7.00, precio_f: 7.50, precio_p: 8.00 },
            { nombre: 'PINGÜINO', precio_m: 13.00, precio_f: 13.50, precio_p: 14.00 },
            { nombre: 'ALMENDRA CONFITADA', precio_m: 15.00, precio_f: 15.50, precio_p: 16.00 },
            { nombre: 'OSITOS', precio_m: 9.00, precio_f: 9.50, precio_p: 10.00 },
            { nombre: 'MANGUITO ENCHILADO', precio_m: 10.50, precio_f: 11.00, precio_p: 11.50 },
            { nombre: 'GUSANITOS', precio_m: 8.50, precio_f: 9.00, precio_p: 9.50 }
        ];

        let orden = [];

        buscarProductoInput.addEventListener('input', function() {
            const textoBusqueda = this.value.toUpperCase();
            const productosFiltrados = productos.filter(producto => producto.nombre.toUpperCase().includes(textoBusqueda));

            listaProductos.innerHTML = '';
            if (textoBusqueda && productosFiltrados.length > 0) {
                listaProductos.style.display = 'block';
                productosFiltrados.forEach(producto => {
                    const li = document.createElement('li');
                    li.textContent = producto.nombre;
                    li.dataset.nombre = producto.nombre;
                    li.dataset.precioM = producto.precio_m;
                    li.dataset.precioF = producto.precio_f;
                    li.dataset.precioP = producto.precio_p;
                    li.addEventListener('click', function() {
                        buscarProductoInput.value = this.dataset.nombre;
                        precioProductoInput.value = ''; // Limpiar precio al seleccionar nuevo producto
                        listaProductos.style.display = 'none';
                    });
                    listaProductos.appendChild(li);
                });
            } else {
                listaProductos.style.display = 'none';
            }
        });

        proveedorSelect.addEventListener('change', function() {
            const proveedorSeleccionado = this.value;
            const productoSeleccionado = productos.find(p => p.nombre === buscarProductoInput.value);

            if (productoSeleccionado && proveedorSeleccionado) {
                precioProductoInput.value = productoSeleccionado[`precio_${proveedorSeleccionado.toLowerCase()}`] || '';
            } else {
                precioProductoInput.value = '';
            }
        });

        agregarProductoButton.addEventListener('click', function() {
            const nombreProducto = buscarProductoInput.value;
            const precioUnitario = parseFloat(precioProductoInput.value);
            const cantidad = parseInt(cantidadOrdenInput.value);

            if (nombreProducto && !isNaN(precioUnitario) && !isNaN(cantidad) && cantidad > 0) {
                const productoExistente = orden.find(item => item.nombre === nombreProducto);
                if (productoExistente) {
                    productoExistente.cantidad += cantidad;
                    productoExistente.subtotal = productoExistente.precio * productoExistente.cantidad;
                } else {
                    orden.push({
                        nombre: nombreProducto,
                        precio: precioUnitario,
                        cantidad: cantidad,
                        subtotal: precioUnitario * cantidad
                    });
                }
                actualizarTablaOrden();
                buscarProductoInput.value = '';
                precioProductoInput.value = '';
                cantidadOrdenInput.value = 1;
                proveedorSelect.value = '';
                listaProductos.style.display = 'none';
            } else {
                alert('Por favor, seleccione un producto, proveedor y una cantidad válida.');
            }
        });

        function actualizarTablaOrden() {
            cuerpoTablaOrden.innerHTML = '';
            let total = 0;
            orden.forEach(item => {
                const fila = cuerpoTablaOrden.insertRow();
                const celdaNombre = fila.insertCell();
                const celdaPrecio = fila.insertCell();
                const celdaCantidad = fila.insertCell();
                const celdaSubtotal = fila.insertCell();

                celdaNombre.textContent = item.nombre;
                celdaPrecio.textContent = `$${item.precio.toFixed(2)}`;
                celdaCantidad.textContent = item.cantidad;
                celdaSubtotal.textContent = `$${item.subtotal.toFixed(2)}`;
                celdaPrecio.style.textAlign = 'right';
                celdaCantidad.style.textAlign = 'right';
                celdaSubtotal.style.textAlign = 'right';
                total += item.subtotal;
            });
            totalOrdenElement.textContent = `$${total.toFixed(2)}`;
        }

        confirmarOrdenButton.addEventListener('click', function() {
            if (orden.length > 0) {
                alert('Orden de compra confirmada. Los detalles son:\n' + JSON.stringify(orden, null, 2) + '\nTotal: ' + totalOrdenElement.textContent);
                // Aquí iría la lógica para enviar la orden al servidor
                orden = [];
                actualizarTablaOrden();
            } else {
                alert('La orden de compra está vacía. Agregue productos.');
            }
        });

        // Ocultar la lista de productos al hacer clic fuera
        document.addEventListener('click', function(event) {
            if (!event.target.matches('#buscar_producto')) {
                listaProductos.style.display = 'none';
            }
        });
    </script>
    <script type="module">
  const buscarProductoInput = document.getElementById('buscar_producto');
  const listaProductos = document.getElementById('lista_productos');
  const proveedorSelect = document.getElementById('proveedor');
  const precioProductoInput = document.getElementById('precio_producto');
  const cantidadOrdenInput = document.getElementById('cantidad_orden');
  const agregarProductoButton = document.getElementById('agregar_producto');
  const cuerpoTablaOrden = document.getElementById('cuerpo_tabla_orden');
  const totalOrdenElement = document.getElementById('total_orden');
  const confirmarOrdenButton = document.getElementById('confirmar_orden');

  import { db } from './firebase.js'; // Importa la instancia de Firestore
  import { collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

  let productos = [
      { nombre: 'LUNETAS', precio_m: 10.00, precio_f: 10.50, precio_p: 11.00 },
      { nombre: 'DIENTES TIBURONES', precio_m: 12.00, precio_f: 12.50, precio_p: 13.00 },
      { nombre: 'HUEVITO PINTO', precio_m: 8.00, precio_f: 8.50, precio_p: 9.00 },
      { nombre: 'GUSANITO NEON', precio_m: 9.50, precio_f: 10.00, precio_p: 10.50 },
      { nombre: 'OSITO ENCHILADO', precio_m: 11.50, precio_f: 12.00, precio_p: 12.50 },
      { nombre: 'GOTITAS', precio_m: 7.00, precio_f: 7.50, precio_p: 8.00 },
      { nombre: 'PINGÜINO', precio_m: 13.00, precio_f: 13.50, precio_p: 14.00 },
      { nombre: 'ALMENDRA CONFITADA', precio_m: 15.00, precio_f: 15.50, precio_p: 16.00 },
      { nombre: 'OSITOS', precio_m: 9.00, precio_f: 9.50, precio_p: 10.00 },
      { nombre: 'MANGUITO ENCHILADO', precio_m: 10.50, precio_f: 11.00, precio_p: 11.50 },
      { nombre: 'GUSANITOS', precio_m: 8.50, precio_f: 9.00, precio_p: 9.50 }
  ];

  let orden = [];

  buscarProductoInput.addEventListener('input', function() {
      const textoBusqueda = this.value.toUpperCase();
      const productosFiltrados = productos.filter(producto => producto.nombre.toUpperCase().includes(textoBusqueda));

      listaProductos.innerHTML = '';
      if (textoBusqueda && productosFiltrados.length > 0) {
          listaProductos.style.display = 'block';
          productosFiltrados.forEach(producto => {
              const li = document.createElement('li');
              li.textContent = producto.nombre;
              li.dataset.nombre = producto.nombre;
              li.dataset.precioM = producto.precio_m;
              li.dataset.precioF = producto.precio_f;
              li.dataset.precioP = producto.precio_p;
              li.addEventListener('click', function() {
                  buscarProductoInput.value = this.dataset.nombre;
                  precioProductoInput.value = ''; // Limpiar precio al seleccionar nuevo producto
                  listaProductos.style.display = 'none';
              });
              listaProductos.appendChild(li);
          });
      } else {
          listaProductos.style.display = 'none';
      }
  });

  proveedorSelect.addEventListener('change', function() {
      const proveedorSeleccionado = this.value;
      const productoSeleccionado = productos.find(p => p.nombre === buscarProductoInput.value);

      if (productoSeleccionado && proveedorSeleccionado) {
          precioProductoInput.value = productoSeleccionado[`precio_${proveedorSeleccionado.toLowerCase()}`] || '';
      } else {
          precioProductoInput.value = '';
      }
  });

  agregarProductoButton.addEventListener('click', function() {
      const nombreProducto = buscarProductoInput.value;
      const precioUnitario = parseFloat(precioProductoInput.value);
      const cantidad = parseInt(cantidadOrdenInput.value);

      if (nombreProducto && !isNaN(precioUnitario) && !isNaN(cantidad) && cantidad > 0) {
          const productoExistente = orden.find(item => item.nombre === nombreProducto);
          if (productoExistente) {
              productoExistente.cantidad += cantidad;
              productoExistente.subtotal = productoExistente.precio * productoExistente.cantidad;
          } else {
              orden.push({
                  nombre: nombreProducto,
                  precio: precioUnitario,
                  cantidad: cantidad,
                  subtotal: precioUnitario * cantidad
              });
          }
          actualizarTablaOrden();
          buscarProductoInput.value = '';
          precioProductoInput.value = '';
          cantidadOrdenInput.value = 1;
          proveedorSelect.value = '';
          listaProductos.style.display = 'none';
      } else {
          alert('Por favor, seleccione un producto, proveedor y una cantidad válida.');
      }
  });

  function actualizarTablaOrden() {
      cuerpoTablaOrden.innerHTML = '';
      let total = 0;
      orden.forEach(item => {
          const fila = cuerpoTablaOrden.insertRow();
          const celdaNombre = fila.insertCell();
          const celdaPrecio = fila.insertCell();
          const celdaCantidad = fila.insertCell();
          const celdaSubtotal = fila.insertCell();

          celdaNombre.textContent = item.nombre;
          celdaPrecio.textContent = `$${item.precio.toFixed(2)}`;
          celdaCantidad.textContent = item.cantidad;
          celdaSubtotal.textContent = `$${item.subtotal.toFixed(2)}`;
          celdaPrecio.style.textAlign = 'right';
          celdaCantidad.style.textAlign = 'right';
          celdaSubtotal.style.textAlign = 'right';
          total += item.subtotal;
      });
      totalOrdenElement.textContent = `$${total.toFixed(2)}`;
  }

  confirmarOrdenButton.addEventListener('click', function() {
      if (orden.length > 0) {
          alert('Orden de compra confirmada. Los detalles son:\n' + JSON.stringify(orden, null, 2) + '\nTotal: ' + totalOrdenElement.textContent);

          // Enviar la orden a Firestore
          const ordenesCollection = collection(db, 'ordenes'); // 'ordenes' será el nombre de tu colección
          addDoc(ordenesCollection, orden)
              .then((docRef) => {
                  console.log("Orden guardada en Firestore con ID: ", docRef.id);
                  orden = [];
                  actualizarTablaOrden();
              })
              .catch((error) => {
                  console.error("Error al guardar la orden:", error);
              });

      } else {
          alert('La orden de compra está vacía. Agregue productos.');
      }
  });

  // Ocultar la lista de productos al hacer clic fuera
  document.addEventListener('click', function(event) {
      if (!event.target.matches('#buscar_producto')) {
          listaProductos.style.display = 'none';
      }
  });
       </script>
    
</body>
</html>
